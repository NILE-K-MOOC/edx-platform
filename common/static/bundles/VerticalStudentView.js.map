{"version":3,"sources":["webpack:///./common/lib/xmodule/xmodule/assets/vertical/public/js/vertical_student_view.js","webpack:///./lms/static/completion/js/CompletionOnViewService.js","webpack:///./lms/static/completion/js/ViewedEvent.js","webpack:///./lms/static/js/views/message_banner.js","webpack:///./lms/templates/fields/message_banner.underscore","webpack:///./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js","webpack:///external \"jQuery\"?0cb8********","webpack:///external \"_\"?b3b9*******","webpack:///external \"Backbone\"?709d******","webpack:///external \"gettext\"?8b52**"],"names":["SEEN_COMPLETABLES","Set","window","VerticalStudentView","runtime","element","$element","$","$bookmarkButtonElement","find","markBlocksCompletedOnViewIfNeeded","el","bookmarkId","data","usageId","bookmarked","parent","apiUrl","completedBlocksKeys","containerElement","blockElements","get","length","tracker","forEach","blockElement","markCompletedOnViewAfterDelay","parseInt","dataset","addElement","addHandler","event","blockKey","has","elementHasBeenViewed","ajax","type","url","handlerUrl","JSON","stringify","completion","then","add","throttle","fn","wait","time","delay","now","Date","ElementViewing","viewedAfterMs","callback","topSeen","bottomSeen","seenForMs","becameVisibleAt","undefined","hasBeenViewed","getBoundingClientRect","setTimeout","checkIfViewed","getTotalTimeSeen","areViewedCriteriaMet","ViewedEventTracker","elementViewings","handlers","registerDomHandlers","callHandlers","updateVisible","handler","push","elv","rect","getBoundingRect","visible","top","innerHeight","markTopSeen","bottom","markBottomSeen","handleVisible","handleNotVisible","onscroll","onresize","gettext","_","Backbone","messageBannerTemplate","MessageBannerView","View","extend","initialize","options","isUndefined","defaults","urgency","render","message","isNull","$el","html","template","showMessage","hideMessage","errorMessage","bookmarkText","bookmarkedText","events","click","showBannerInterval","setBookmarkState","toggleBookmark","preventDefault","prop","hasClass","removeBookmark","addBookmark","view","usage_id","dataType","success","trigger","error","jqXHR","response","userMessage","responseText","parse","user_message","showError","err","complete","focus","deleteUrl","addClass","attr","text","removeClass","errorText","errorMsg","messageView","bind"],"mappings":"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","file":"VerticalStudentView.js","sourcesContent":["/* JavaScript for Vertical Student View. */\n\n/* global Set:false */ // false means do not assign to Set\n\n// The vertical marks blocks complete if they are completable by viewing.  The\n// global variable SEEN_COMPLETABLES tracks blocks between separate loads of\n// the same vertical (when a learner goes from one tab to the next, and then\n// navigates back within a given sequential) to protect against duplicate calls\n// to the server.\n\nimport BookmarkButton from 'course_bookmarks/js/views/bookmark_button';\nimport {markBlocksCompletedOnViewIfNeeded} from '../../../../../../../../lms/static/completion/js/CompletionOnViewService.js';\n\nvar SEEN_COMPLETABLES = new Set();\n\nwindow.VerticalStudentView = function(runtime, element) {\n    'use strict';\n    var $element = $(element);\n    var $bookmarkButtonElement = $element.find('.bookmark-button');\n    markBlocksCompletedOnViewIfNeeded(runtime, element);\n    return new BookmarkButton({\n        el: $bookmarkButtonElement,\n        bookmarkId: $bookmarkButtonElement.data('bookmarkId'),\n        usageId: $element.data('usageId'),\n        bookmarked: $element.parent('#seq_content').data('bookmarked'),\n        apiUrl: $bookmarkButtonElement.data('bookmarksApiUrl')\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./common/lib/xmodule/xmodule/assets/vertical/public/js/vertical_student_view.js","import { ViewedEventTracker } from './ViewedEvent';\n\nconst completedBlocksKeys = new Set();\n\nexport function markBlocksCompletedOnViewIfNeeded(runtime, containerElement) {\n  const blockElements = $(containerElement).find(\n    '.xblock-student_view[data-mark-completed-on-view-after-delay]',\n  ).get();\n\n  if (blockElements.length > 0) {\n    const tracker = new ViewedEventTracker();\n\n    blockElements.forEach((blockElement) => {\n      const markCompletedOnViewAfterDelay = parseInt(\n        blockElement.dataset.markCompletedOnViewAfterDelay, 10,\n      );\n      if (markCompletedOnViewAfterDelay >= 0) {\n        tracker.addElement(blockElement, markCompletedOnViewAfterDelay);\n      }\n    });\n\n    tracker.addHandler((blockElement, event) => {\n      const blockKey = blockElement.dataset.usageId;\n      if (blockKey && !completedBlocksKeys.has(blockKey)) {\n        if (event.elementHasBeenViewed) {\n          $.ajax({\n            type: 'POST',\n            url: runtime.handlerUrl(blockElement, 'publish_completion'),\n            data: JSON.stringify({\n              completion: 1.0,\n            }),\n          }).then(\n            () => {\n              completedBlocksKeys.add(blockKey);\n              blockElement.dataset.markCompletedOnViewAfterDelay = 0;\n            },\n          );\n        }\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/completion/js/CompletionOnViewService.js","/** Ensure that a function is only run once every `wait` milliseconds */\nfunction throttle(fn, wait) {\n  let time = 0;\n  function delay() {\n    // Do not call the function until at least `wait` seconds after the\n    // last time the function was called.\n    const now = Date.now();\n    if (time + wait < now) {\n      time = now;\n      fn();\n    }\n  }\n  return delay;\n}\n\n\nexport class ElementViewing {\n  /**\n   * A wrapper for an HTMLElement that tracks whether the element has been\n   * viewed or not.\n   */\n  constructor(el, viewedAfterMs, callback) {\n    this.el = el;\n    this.viewedAfterMs = viewedAfterMs;\n    this.callback = callback;\n\n    this.topSeen = false;\n    this.bottomSeen = false;\n    this.seenForMs = 0;\n    this.becameVisibleAt = undefined;\n    this.hasBeenViewed = false;\n  }\n\n  getBoundingRect() {\n    return this.el.getBoundingClientRect();\n  }\n\n  /** This element has become visible on screen.\n   *\n   * (may be called even when already on screen though)\n   */\n  handleVisible() {\n    if (!this.becameVisibleAt) {\n      this.becameVisibleAt = Date.now();\n      // We're now visible; after viewedAfterMs, if the top and bottom have been\n      // seen, this block will count as viewed.\n      setTimeout(\n        () => {\n          this.checkIfViewed();\n        },\n        this.viewedAfterMs - this.seenForMs,\n      );\n    }\n  }\n\n  handleNotVisible() {\n    if (this.becameVisibleAt) {\n      this.seenForMs = Date.now() - this.becameVisibleAt;\n    }\n    this.becameVisibleAt = undefined;\n  }\n\n  markTopSeen() {\n    // If this element has been seen for enough time, but the top wasn't visible, it may now be\n    // considered viewed.\n    this.topSeen = true;\n    this.checkIfViewed();\n  }\n\n  markBottomSeen() {\n    this.bottomSeen = true;\n    this.checkIfViewed();\n  }\n\n  getTotalTimeSeen() {\n    if (this.becameVisibleAt) {\n      return this.seenForMs + (Date.now() - this.becameVisibleAt);\n    }\n    return this.seenForMs;\n  }\n\n  areViewedCriteriaMet() {\n    return this.topSeen && this.bottomSeen && (this.getTotalTimeSeen() >= this.viewedAfterMs);\n  }\n\n  checkIfViewed() {\n    // User can provide a \"now\" value for testing purposes.\n    if (this.hasBeenViewed) {\n      return;\n    }\n    if (this.areViewedCriteriaMet()) {\n      this.hasBeenViewed = true;\n      // Report to the tracker that we have been viewed\n      this.callback(this.el, { elementHasBeenViewed: this.hasBeenViewed });\n    }\n  }\n}\n\n\nexport class ViewedEventTracker {\n  /**\n   * When the top or bottom of an element is first viewed, and the entire\n   * element is viewed for a specified amount of time, the callback is called,\n   * passing the element that was viewed, and an event object having the\n   * following field:\n   *\n   * *   hasBeenViewed (bool): true if all the conditions for being\n   *     considered \"viewed\" have been met.\n   */\n  constructor() {\n    this.elementViewings = new Set();\n    this.handlers = [];\n    this.registerDomHandlers();\n  }\n\n  /** Add an element to track.  */\n  addElement(element, viewedAfterMs) {\n    this.elementViewings.add(\n     new ElementViewing(\n       element,\n       viewedAfterMs,\n       (el, event) => this.callHandlers(el, event),\n      ),\n    );\n    this.updateVisible();\n  }\n\n  /** Register a new handler to be called when an element has been viewed.  */\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n\n  /** Mark which elements are currently visible.\n   *\n   *  Also marks when an elements top or bottom has been seen.\n   * */\n  updateVisible() {\n    this.elementViewings.forEach((elv) => {\n      if (elv.hasBeenViewed) {\n        return;\n      }\n\n      const now = Date.now(); // Use the same \"now\" for all calculations\n      const rect = elv.getBoundingRect();\n      let visible = false;\n\n      if (rect.top > 0 && rect.top < window.innerHeight) {\n        elv.markTopSeen(now);\n        visible = true;\n      }\n      if (rect.bottom > 0 && rect.bottom < window.innerHeight) {\n        elv.markBottomSeen(now);\n        visible = true;\n      }\n      if (rect.top < 0 && rect.bottom > window.innerHeight) {\n        visible = true;\n      }\n\n      if (visible) {\n        elv.handleVisible(now);\n      } else {\n        elv.handleNotVisible(now);\n      }\n    });\n  }\n\n  registerDomHandlers() {\n    window.onscroll = throttle(() => this.updateVisible(), 100);\n    window.onresize = throttle(() => this.updateVisible(), 100);\n    this.updateVisible();\n  }\n\n  /** Call the handlers for all newly-viewed elements and pause tracking\n   *  for recently disappeared elements.\n   */\n  callHandlers(el, event) {\n    this.handlers.forEach((handler) => {\n      handler(el, event);\n    });\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/completion/js/ViewedEvent.js","\n    'use strict';\n    define([\n        'gettext', 'jquery', 'underscore', 'backbone', 'templates/fields/message_banner.underscore'\n    ], function(gettext, $, _, Backbone, messageBannerTemplate) {\n        var MessageBannerView = Backbone.View.extend({\n\n            initialize: function(options) {\n                if (_.isUndefined(options)) {\n                    options = {};\n                }\n                this.options = _.defaults(options, {urgency: 'high', type: ''});\n            },\n\n            render: function() {\n                if (_.isUndefined(this.message) || _.isNull(this.message)) {\n                    this.$el.html('');\n                } else {\n                    this.$el.html(_.template(messageBannerTemplate)(_.extend(this.options, {\n                        message: this.message\n                    })));\n                }\n                return this;\n            },\n\n            showMessage: function(message) {\n                this.message = message;\n                this.render();\n            },\n\n            hideMessage: function() {\n                this.message = null;\n                this.render();\n            }\n        });\n\n        return MessageBannerView;\n    });\n\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/views/message_banner.js","module.exports = \"<div class=\\\"wrapper-msg urgency-<%= urgency %> <%= type %>\\\">\\n    <div class=\\\"msg\\\">\\n        <div class=\\\"msg-content\\\">\\n            <div class=\\\"copy\\\">\\n                <p><%-message%></p>\\n            </div>\\n        </div>\\n    </div>\\n</div>\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lms/templates/fields/message_banner.underscore\n// module id = ./lms/templates/fields/message_banner.underscore\n// module chunks = 12","\n    'use strict';\n\n    define(['gettext', 'jquery', 'underscore', 'backbone', 'js/views/message_banner'],\n        function(gettext, $, _, Backbone, MessageBannerView) {\n            return Backbone.View.extend({\n                errorMessage: gettext('An error has occurred. Please try again.'),\n\n                bookmarkText: gettext('Bookmark this page'),\n                bookmarkedText: gettext('Bookmarked'),\n\n                events: {\n                    click: 'toggleBookmark'\n                },\n\n                showBannerInterval: 5000,   // time in ms\n\n                initialize: function(options) {\n                    this.apiUrl = options.apiUrl;\n                    this.bookmarkId = options.bookmarkId;\n                    this.bookmarked = options.bookmarked;\n                    this.usageId = options.usageId;\n                    this.setBookmarkState(this.bookmarked);\n                },\n\n                toggleBookmark: function(event) {\n                    event.preventDefault();\n\n                    this.$el.prop('disabled', true);\n\n                    if (this.$el.hasClass('bookmarked')) {\n                        this.removeBookmark();\n                    } else {\n                        this.addBookmark();\n                    }\n                },\n\n                addBookmark: function() {\n                    var view = this;\n                    $.ajax({\n                        data: {usage_id: view.usageId},\n                        type: 'POST',\n                        url: view.apiUrl,\n                        dataType: 'json',\n                        success: function() {\n                            view.$el.trigger('bookmark:add');\n                            view.setBookmarkState(true);\n                        },\n                        error: function(jqXHR) {\n                            var response, userMessage;\n                            try {\n                                response = jqXHR.responseText ? JSON.parse(jqXHR.responseText) : '';\n                                userMessage = response ? response.user_message : '';\n                                view.showError(userMessage);\n                            } catch (err) {\n                                view.showError();\n                            }\n                        },\n                        complete: function() {\n                            view.$el.prop('disabled', false);\n                            view.$el.focus();\n                        }\n                    });\n                },\n\n                removeBookmark: function() {\n                    var view = this;\n                    var deleteUrl = view.apiUrl + view.bookmarkId + '/';\n\n                    $.ajax({\n                        type: 'DELETE',\n                        url: deleteUrl,\n                        success: function() {\n                            view.$el.trigger('bookmark:remove');\n                            view.setBookmarkState(false);\n                        },\n                        error: function() {\n                            view.showError();\n                        },\n                        complete: function() {\n                            view.$el.prop('disabled', false);\n                            view.$el.focus();\n                        }\n                    });\n                },\n\n                setBookmarkState: function(bookmarked) {\n                    if (bookmarked) {\n                        this.$el.addClass('bookmarked');\n                        this.$el.attr('aria-pressed', 'true');\n                        this.$el.find('.bookmark-text').text(this.bookmarkedText);\n                    } else {\n                        this.$el.removeClass('bookmarked');\n                        this.$el.attr('aria-pressed', 'false');\n                        this.$el.find('.bookmark-text').text(this.bookmarkText);\n                    }\n                },\n\n                showError: function(errorText) {\n                    var errorMsg = errorText || this.errorMessage;\n\n                    if (!this.messageView) {\n                        this.messageView = new MessageBannerView({\n                            el: $('.message-banner'),\n                            type: 'error'\n                        });\n                    }\n                    this.messageView.showMessage(errorMsg);\n\n                    // Hide message automatically after some interval\n                    setTimeout(_.bind(function() {\n                        this.messageView.hideMessage();\n                    }, this), this.showBannerInterval);\n                }\n            });\n        });\n\n\n\n\n// WEBPACK FOOTER //\n// ./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js","(function() { module.exports = window[\"jQuery\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 1 2 3 4 7 8 9 11 12 13 14 15 16 17 18 19 22 23 24 25 26 27 28 29 30 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 83","(function() { module.exports = window[\"_\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"_\"\n// module id = 1\n// module chunks = 1 2 3 4 7 8 9 12 13 14 16 17 18 19 22 23 24 25 26 27 28 29 30 33 34 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74","(function() { module.exports = window[\"Backbone\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Backbone\"\n// module id = 2\n// module chunks = 1 3 4 7 8 9 12 13 18 19 22 23 32 84","(function() { module.exports = window[\"gettext\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"gettext\"\n// module id = 3\n// module chunks = 3 4 8 12 13 14 18 19 23"],"sourceRoot":""}