{"version":3,"sources":["webpack:///./lms/static/js/learner_dashboard/unenrollment_factory.js","webpack:///./lms/static/js/learner_dashboard/views/unenroll_view.js","webpack:///external \"jQuery\"?0cb8*************************","webpack:///external \"Backbone\"?709d***********"],"names":["UnenrollmentFactory","options","UnenrollView","defaults","el","triggerElement","$previouslyFocusedElement","survey","document","querySelector","i","children","length","appendChild","Math","trunc","random","$","hide","removeClass","window","trapFocusForAccessibleModal","focusableElementsString","closeButtonSelector","modalId","mainPageSelector","reason","attr","val","analytics","track","category","label","displayName","addClass","text","urls","dashboard","browseCourses","event","xhr","status","isEdx","location","href","switchToSlideOne","click","switchToSlideTwo","bind","signInUser","encodeURIComponent","gettext","stop","css","prop","view","$closeButton","$el","triggerSelector","each","attachTriggerHandler","index","element","on","handleTrigger","startSubmit","unenrollComplete","Backbone","View"],"mappings":"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","file":"UnenrollmentFactory.js","sourcesContent":["import UnenrollView from './views/unenroll_view';\n\nfunction UnenrollmentFactory(options) {\n  return new UnenrollView(options);\n}\n\nexport { UnenrollmentFactory }; // eslint-disable-line import/prefer-default-export\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/unenrollment_factory.js","/* globals gettext */\n\nimport Backbone from 'backbone';\n\nclass UnenrollView extends Backbone.View {\n\n  constructor(options) {\n    const defaults = {\n      el: '.unenroll-modal',\n    };\n    super(Object.assign({}, defaults, options));\n  }\n\n  handleTrigger(triggerElement) {\n    this.$previouslyFocusedElement = triggerElement;\n  }\n\n  switchToSlideOne() {\n    // Randomize survey option order\n    const survey = document.querySelector('.options');\n    for (let i = survey.children.length - 1; i >= 0; i -= 1) {\n      survey.appendChild(survey.children[Math.trunc(Math.random() * i)]);\n    }\n    this.$('.inner-wrapper header').hide();\n    this.$('#unenroll_form').hide();\n    this.$('.slide1').removeClass('hidden');\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  switchToSlideTwo() {\n    let reason = this.$(\".reasons_survey input[name='reason']:checked\").attr('val');\n    if (reason === 'Other') {\n      reason = this.$('.other_text').val();\n    }\n    if (reason) {\n      window.analytics.track('unenrollment_reason.selected', {\n        category: 'user-engagement',\n        label: reason,\n        displayName: 'v1',\n      });\n    }\n    this.$('.slide1').addClass('hidden');\n    this.$('.survey_course_name').text(this.$('#unenroll_course_name').text());\n    this.$('.slide2').removeClass('hidden');\n    this.$('.reasons_survey .return_to_dashboard').attr('href', this.urls.dashboard);\n    this.$('.reasons_survey .browse_courses').attr('href', this.urls.browseCourses);\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  unenrollComplete(event, xhr) {\n    if (xhr.status === 200) {\n      if (!this.isEdx) {\n        location.href = this.urls.dashboard;\n      } else {\n        this.switchToSlideOne();\n        this.$('.reasons_survey:first .submit_reasons').click(this.switchToSlideTwo.bind(this));\n      }\n    } else if (xhr.status === 403) {\n      location.href = `${this.urls.signInUser}?course_id=${\n        encodeURIComponent($('#unenroll_course_id').val())}&enrollment_action=unenroll`;\n    } else {\n      $('#unenroll_error').text(\n        gettext('Unable to determine whether we should give you a refund because' +\n                ' of System Error. Please try again later.'),\n      ).stop()\n       .css('display', 'block');\n    }\n  }\n\n  startSubmit() {\n    this.$('.submit').prop('disabled', true);\n  }\n\n  initialize(options) {\n    const view = this;\n\n    this.urls = options.urls;\n    this.isEdx = options.isEdx;\n\n    this.closeButtonSelector = '.unenroll-modal .close-modal';\n    this.$closeButton = $(this.closeButtonSelector);\n    this.modalId = `#${this.$el.attr('id')}`;\n    this.mainPageSelector = '#dashboard-main';\n\n    this.triggerSelector = '.action-unenroll';\n    $(this.triggerSelector).each(function attachTriggerHandler(index, element) {\n      $(element).on('click', view.handleTrigger.bind($(element)));\n    });\n\n    this.$('.submit .submit-button').on('click', this.startSubmit.bind(this));\n    $('#unenroll_form').on('ajax:complete', this.unenrollComplete.bind(this));\n  }\n}\n\nexport default UnenrollView;\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/views/unenroll_view.js","(function() { module.exports = window[\"jQuery\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 3 4 5 6 9 10 11 13 14 15 16 17 18 19 20 21 23 24 25 26 27 28 29 30 31 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 84","(function() { module.exports = window[\"Backbone\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Backbone\"\n// module id = 2\n// module chunks = 3 5 6 9 10 11 14 15 20 21 23 24 33 85"],"sourceRoot":""}